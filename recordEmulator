#!/bin/bash

HELP="Usage: $(basename $0) [filename].[extension] [ -p PATH ]"
CURRENT_DIR="${PWD}"
SAVE_DIR="${CURRENT_DIR}"

if [ -z "$1" ]; then
	echo "$HELP"
    exit 1
fi

while getopts "p:" opt ${@:2}; do
    case "$opt" in
        p)
            SAVE_DIR=${OPTARG};;
        *)
            echo "$HELP"
            exit 1;;
    esac
done

echo "File will be saved under ${SAVE_DIR}/${1}"
if [ $SAVE_DIR != $CURRENT_DIR ]; then
    mkdir -p $SAVE_DIR && cd $SAVE_DIR
fi

echo "Wait for recording to start... press CTRL+C to stop"
xcrun simctl io booted recordVideo "$1"